<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèÜ GARGOLAS AWARDS 2025 üèÜ</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  max-width:1000px;
  margin:auto;
  padding:20px;
  background:linear-gradient(135deg,#1a1a2e,#16213e,#0f0f23);
  color:#b08d32;
  min-height:100vh;
}

.container{
  background:#2d2d44;
  padding:30px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,.6);
}

h1{text-align:center;margin-bottom:10px;animation:pulse 2s infinite}
.subtitle{text-align:center;margin-bottom:30px;font-size:1.1em}

@keyframes pulse{
  0%,100%{text-shadow:0 0 5px #b08d32}
  50%{text-shadow:0 0 20px #b08d32}
}

.hidden{display:none}

.registro{
  text-align:center;
  padding:40px;
  border:1px solid #b08d32;
  border-radius:20px;
}

input{
  padding:15px;
  margin:10px;
  width:280px;
  max-width:90vw;
  background:#1e1e2e;
  border:2px solid #505077;
  color:#b08d32;
  border-radius:12px;
  font-size:16px;
}

input:focus{outline:none;border-color:#b08d32;box-shadow:0 0 10px rgba(176,141,50,.3)}

button{
  background:linear-gradient(45deg,#9c7c19,#b08d32);
  color:#fff;
  padding:15px 30px;
  border:none;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  transition:.3s;
  margin:5px;
}

button:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 5px 15px rgba(176,141,50,.4)}
button:disabled{opacity:.4;cursor:not-allowed;background:#505077}

.user-info{text-align:center;margin-bottom:20px;font-size:18px}

.terna{
  display:none;
  background:linear-gradient(135deg,#2a2a4e,#3a2a3e);
  padding:30px;
  border-radius:20px;
  animation:fade .5s ease;
  margin:10px 0;
}

.terna.activa{display:block}

.terna-invotable{
  background:linear-gradient(135deg,#1a1a2e,#2a2a3e);
  color:#888;
  border:2px dashed #505077;
}

@keyframes fade{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}

.ternas-container {margin: 20px 0;}

.opciones{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-top:20px;
  min-height:120px;
  align-items:center;
  justify-content:center;
}

.opcion{
  flex:1 1 180px;
  max-width:200px;
  padding:18px;
  background:#3a3a5a;
  border-radius:15px;
  border:2px solid #505077;
  cursor:pointer;
  text-align:center;
  transition:.3s;
  font-size:14px;
  word-break:break-word;
  user-select:none;
  position:relative;
}

.opcion .video-icon {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(176,141,50,0.8);
  color: white;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.opcion:hover:not(.votado):not(.disabled){border-color:#b08d32;transform:translateY(-2px)}

.opcion.votado{
  background:linear-gradient(45deg,#9c7c19,#b08d32);
  color:#fff;
  font-weight:bold;
  border-color:#fff;
}

.opcion.disabled{
  opacity:0.5;
  cursor:not-allowed;
  background:#2a2a3e;
}

.nav{
  display:flex;
  justify-content:space-between;
  margin-top:25px;
  gap:10px;
}

.stats{
  margin-top:30px;
  background:#1e1e2e;
  padding:20px;
  border-radius:15px;
  text-align:center;
  font-size:18px;
}

.progress-bar{
  width:100%;
  height:8px;
  background:#2a2a3e;
  border-radius:4px;
  overflow:hidden;
  margin:10px 0;
}

.progress-fill{
  height:100%;
  background:linear-gradient(90deg,#9c7c19,#b08d32);
  transition:width 0.3s ease;
  border-radius:4px;
}

.completado{
  background:linear-gradient(135deg,#4CAF50,#45a049);
  color:#fff;
  padding:30px;
  text-align:center;
  border-radius:20px;
  animation:fade 0.8s ease;
}

.error-msg{
  background:#ff4444;
  color:white;
  padding:15px;
  border-radius:10px;
  margin:10px 0;
  text-align:center;
  display:none;
}

.success-msg{
  background:#4CAF50;
  color:white;
  padding:15px;
  border-radius:10px;
  margin:10px 0;
  text-align:center;
  display:none;
}

.video-modal{
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.video-modal.activo{display:flex;}

.mini-player{
  position:relative;
  width:90%;
  max-width:640px;
  max-height:80vh;
}

.mini-player iframe{
  width:100%;
  height:360px;
  max-height:70vh;
  border:none;
  border-radius:12px;
  aspect-ratio: 9/16;
}

.cerrar-video{
  position:absolute;
  top:-15px;
  right:-15px;
  background:rgba(0,0,0,0.8);
  border:2px solid #fff;
  border-radius:50%;
  width:40px;
  height:40px;
  font-size:20px;
  cursor:pointer;
  color:#fff;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
}

.cerrar-video:hover {
  background:#ff4444;
  border-color:#ff4444;
}

@media (max-width: 768px) {
  .container{padding:15px}
  input{width:90vw;max-width:300px}
  .opcion{flex:1 1 100%;max-width:100%;padding:15px;font-size:16px}
  .nav{flex-direction:column}
  .nav button{width:100%}
  .mini-player iframe{height:50vh;}
}
</style>
</head>
<body>

<div class="container">
  <h1>üèÜ GARGOLAS AWARDS 2025 üèÜ</h1>
  <p class="subtitle">Votaci√≥n oficial ‚Äî Gargolas 2025</p>

  <div id="error-msg" class="error-msg"></div>
  <div id="success-msg" class="success-msg"></div>

  <div id="registro" class="registro">
    <h2>Registro</h2>
    <input id="nombre" placeholder="Nombre o nick" maxlength="50" required>
    <input id="email" placeholder="Email v√°lido (ej: usuario@dominio.com)" maxlength="100" type="email" required>
    <br><button onclick="registrar()">üöÄ Comenzar Votaci√≥n</button>
  </div>

  <div id="votacion" class="hidden">
    <div class="user-info">
      Hola <strong><span id="usuario"></span></strong> 
      <span id="timestamp" style="font-size:14px;color:#888"></span>
    </div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill" style="width:0%"></div></div>
    <div class="stats">Votos completados: <span id="total">0</span> / <span id="total-ternas">0</span> ternas</div>
    <div class="ternas-container" id="ternas-container"></div>
    <div class="nav">
      <button id="volver" disabled>‚¨Ö Volver</button>
      <button id="siguiente" disabled>Siguiente ‚û°</button>
    </div>
    <div id="completado" class="completado hidden">
      <h2>üéâ ¬°Votaci√≥n Completada!</h2>
      <p>Gracias <strong id="usuario-completado"></strong> por participar en los G√°rgolas Awards 2025.</p>
      <p>Tus votos han sido registrados exitosamente.</p>
      <button onclick="reiniciarVotacion()" style="font-size:20px;padding:20px 40px">üîÑ Nueva Votaci√≥n</button>
    </div>
  </div>

  <!-- Mini reproductor -->
  <div id="video-modal" class="video-modal">
    <div class="mini-player">
      <button class="cerrar-video" onclick="cerrarVideo()" aria-label="Cerrar video">‚úï</button>
      <iframe id="mini-video" frameborder="0" allowfullscreen allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media"></iframe>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyABUYYIU42RnSYxGL5hU4EMcvnIQ80Ycmk",
  authDomain: "gargolas-awards-2025.firebaseapp.com",
  projectId: "gargolas-awards-2025",
  storageBucket: "gargolas-awards-2025.firebasestorage.app",
  messagingSenderId: "50729106362",
  appId: "1:50729106362:web:52c2dbc0f953a27c157b83",
  measurementId: "G-WZQYR1EQ2Q"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.addEventListener('DOMContentLoaded', function() {
  const elementos = {
    registro: document.getElementById('registro'),
    votacion: document.getElementById('votacion'),
    usuarioSpan: document.getElementById('usuario'),
    usuarioCompletado: document.getElementById('usuario-completado'),
    ternasContainer: document.getElementById('ternas-container'),
    volverBtn: document.getElementById('volver'),
    siguienteBtn: document.getElementById('siguiente'),
    totalSpan: document.getElementById('total'),
    totalTernasSpan: document.getElementById('total-ternas'),
    progressFill: document.getElementById('progress-fill'),
    timestamp: document.getElementById('timestamp'),
    errorMsg: document.getElementById('error-msg'),
    successMsg: document.getElementById('success-msg'),
    completado: document.getElementById('completado')
  };

  const ternasData = [
    {titulo: "MODS DEL A√ëO üëä", opciones: ["BENJAMIN142420","GERO","BRUNO","LEORAIA","MATEAKD"], votable: true},
    {titulo: "MEJOR VIEWER DEL A√ëO üîú", opciones: ["BENJAMIN142420","BRUNO","GERO","ENZO","JOACO"], votable: true},
    {titulo: "VIEWER REVELACI√ìN üî•", opciones: ["VILLAFANEXO","ENZO","TAMPA","ENZITOGOD","MACCI"], votable: true},
    {titulo: "MOD REVELACI√ìN üí£", opciones: ["BRUNO","ENZO","JOACO","AGRUCK","LEORAIA"], votable: true},
    {titulo: "MEJOR JUGADOR DE HAXBALL ‚öΩ", opciones: ["RF","ZEIKO","SANGU","ABION"], votable: true},
    {titulo: "PEOR JUGADOR DE HAXBALL üí©", opciones: ["BENJAMIN142420","LAMINE","COMECARNE","PALERMO","MACCI"], votable: true},
    {titulo: "TOP WATCHTIME ‚è∞", opciones: ["BENJAMIN142420","GERO","BRUNO","JOAKO","ENZO"], votable: true},
    {titulo: "MEJOR STREAMER DE LA COMUNIDAD üü¢", opciones: ["FACU IRIONDO", "SANTI GRIZAS","TORO FUTBOL","AGRUCK","NATABENITEZZZ"], votable: true},
    {titulo: "MEJOR EDITOR üñ•Ô∏è", opciones: ["MATE","CAMINO","FRANPRODS","LEO TALLERES","FONTANA"], votable: true},
    {titulo: "TOP DONADORES üí∏", opciones: ["NICOBARI","UBI","SANTY","MAXITO","BRUNO"], votable: true},
    {titulo: "MEJOR ARTISTA DEL A√ëO üéôÔ∏è", opciones: ["LP","NAFIELD","TOUZE","DRAKO","MATEAKD"], votable: true},
    {titulo: "MEJOR CHATTER DEL A√ëO üí¨", opciones: ["JOACO","GERO","PABLITOCLIPS","ENZO","ERNESTO"], votable: true},
    {titulo: "MEJOR PJ DEL FC üôé", opciones: ["BRUNO GARGOLAS","BENJAMIN142420 DE RDC","ENZO (LOS 2)","LAMINE SALADO G√ÅRGOLAS","IRIONDO G√ÅRGOLAS"], votable: true},
    {titulo: "VIEWER PROMESA DEL A√ëO üíé", opciones: ["PABLITOCLIPS","ENZITOGOD","SANTY","LAU LOPES","MACCI"], votable: true},
    {titulo: "MEJOR NOMBRE DE LA COMUNIDAD üè∑Ô∏è", opciones: ["SANGUCHITO","LAMINESALADO","FACUREIG","TRABUCODEURUGUAY","AGRUCK"], votable: true},
    {titulo: "MEJOR EDIT DEL A√ëO üëè", opciones: ["FRANPRODS","LEOTALLERES","NAXITORP","MATEAKD"], votable: true},
    {titulo: "MEJOR CLIP DEL A√ëO üìπ", 
     opciones: ["Mauroakd #1","Agruck #1","Macetaxeneize","Agruck #2","MauroAKD #3","MAuroakd #4"], 
     videos: [
       "https://kick.com/maurooakd/clips/clip_01JNMS9Y68PKJ1XXHTQPP87VRQ",
       "https://kick.com/agruck/clips/clip_01KBDVE8FAAWQ4XCVEBWPW1SCZ",
       "https://kick.com/macetaxeneize/clips/clip_01K0R3362B4BYX5T75RMVWXH1Q",
       "https://kick.com/agruck/clips/clip_01KC9YKTXFY1PA93F0GBTX42CT",
       "https://www.tiktok.com/@mercenarioakd12/video/7510801513271414072",
       "https://www.tiktok.com/@mercenarioakd12/video/7510801513271414073"
     ], votable: true},
    {titulo: "VIEWER M√ÅS FACHERO DEL A√ëO üòé", opciones: ["GERO","MATEAKD","FONTANA","SANTY"], votable: true},
    {titulo: "MEJOR TEMA DEL A√ëO üé∂", opciones: ["JOSEO NOCTURNO","WILLY TONKA","GARGOLA","COLD"], votable: true},
    {titulo: "VIEWER M√ÅS PLAGA üï∑Ô∏è", opciones: ["ENZO","ZEIKO","TINELPRO","NOAH","JOACO"], votable: true},
    {titulo: "MEJOR VIP DEL A√ëO üëë", opciones: ["AGUST√çNCARP","NOAH","UBI","MACCI","LAMINESALADO"], votable: true},
    {titulo: "VIEWER M√ÅS OG ‚ò†Ô∏è", opciones: ["TOUZE","FRANPRODS","NICOBARI","LUKITAS","EDAN"], votable: true},
    {titulo: "MEJOR CLIPERO DEL A√ëO üé¨", opciones: ["CLIPSZETA","MAXITO","BRUNO","MATEAKD","UBI"], votable: true},
    {titulo: "MEJOR SETUP DEL A√ëO üíª", opciones: ["LARA","UBI","GONZITO","MACCI"], votable: true},
  ];

  elementos.totalTernasSpan.textContent = ternasData.length;

  let usuarioActual = null;
  let votos = [];
  let indice = 0;
  let ternasGeneradas = [];

  // Funciones utilitarias
  function mostrarError(msg) {
    elementos.errorMsg.textContent = msg;
    elementos.errorMsg.style.display = "block";
    setTimeout(() => { elementos.errorMsg.style.display = "none"; }, 4000);
  }

  function mostrarExito(msg) {
    elementos.successMsg.textContent = msg;
    elementos.successMsg.style.display = "block";
    setTimeout(() => { elementos.successMsg.style.display = "none"; }, 4000);
  }

  function validarEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Funciones globales expuestas
  window.registrar = function() {
    const nombre = document.getElementById('nombre').value.trim();
    const email = document.getElementById('email').value.trim();

    if (!nombre || !email) {
      mostrarError("Debes completar todos los campos");
      return;
    }
    
    if (!validarEmail(email)) {
      mostrarError("Ingresa un email v√°lido");
      return;
    }

    usuarioActual = { nombre, email };
    elementos.usuarioSpan.textContent = nombre;
    elementos.timestamp.textContent = `(${new Date().toLocaleString('es-ES')})`;

    elementos.registro.classList.add('hidden');
    elementos.votacion.classList.remove('hidden');

    generarTernas();
    mostrarTerna(0);
  };

  function generarTernas() {
    elementos.ternasContainer.innerHTML = "";
    ternasGeneradas = [];
    
    ternasData.forEach((terna, i) => {
      const div = document.createElement('div');
      div.className = 'terna';
      div.id = `terna-${i}`;

      const h3 = document.createElement('h3');
      h3.textContent = `${i + 1}. ${terna.titulo}`;
      div.appendChild(h3);

      const opcionesDiv = document.createElement('div');
      opcionesDiv.className = 'opciones';

      terna.opciones.forEach((opcion, j) => {
        const btn = document.createElement('div');
        btn.className = 'opcion';
        btn.textContent = opcion;
        btn.setAttribute('role', 'button');
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', `Votar por ${opcion}`);

        const tieneVideo = terna.videos && terna.videos[j];

        if (tieneVideo) {
          const videoIcon = document.createElement('div');
          videoIcon.className = 'video-icon';
          videoIcon.textContent = 'üé•';
          btn.appendChild(videoIcon);
        }

        btn.addEventListener('click', () => {
          if (terna.votable && !btn.classList.contains('votado')) {
            // Resetear voto anterior en esta terna
            const opcionesActuales = document.querySelectorAll(`#terna-${i} .opcion`);
            opcionesActuales.forEach(op => op.classList.remove('votado'));
            
            votos[i] = opcion;
            btn.classList.add('votado');
            mostrarExito(`Voto registrado: ${opcion}`);
            elementos.siguienteBtn.disabled = false;
          }
          
          if (tieneVideo) {
            abrirVideo(terna.videos[j]);
          }
        });

        // Soporte para teclado
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });

        opcionesDiv.appendChild(btn);
      });

      div.appendChild(opcionesDiv);
      elementos.ternasContainer.appendChild(div);
      ternasGeneradas.push(div);
    });
  }

  function mostrarTerna(idx) {
    indice = idx;
    ternasGeneradas.forEach((t, i) => {
      t.classList.toggle('activa', i === idx);
    });

    elementos.volverBtn.disabled = idx === 0;
    elementos.siguienteBtn.disabled = !votos[indice];

    actualizarProgreso();
  }

  function actualizarProgreso() {
    const votosCompletos = votos.filter(v => v !== undefined).length;
    elementos.totalSpan.textContent = votosCompletos;
    const porcentaje = (votosCompletos / ternasData.length * 100).toFixed(0);
    elementos.progressFill.style.width = `${porcentaje}%`;
  }

  elementos.siguienteBtn.onclick = () => {
    if (indice < ternasData.length - 1) {
      mostrarTerna(indice + 1);
    } else {
      completarVotacion();
    }
  };

  elementos.volverBtn.onclick = () => {
    if (indice > 0) mostrarTerna(indice - 1);
  };

  function completarVotacion() {
    elementos.votacion.classList.add('hidden');
    elementos.completado.classList.remove('hidden');
    elementos.usuarioCompletado.textContent = usuarioActual.nombre;
    guardarVotos();
  }

  window.reiniciarVotacion = function() {
    votos = [];
    indice = 0;
    elementos.completado.classList.add('hidden');
    elementos.votacion.classList.add('hidden');
    elementos.registro.classList.remove('hidden');
    document.getElementById('nombre').value = '';
    document.getElementById('email').value = '';
  };

  async function guardarVotos() {
    if (!usuarioActual) return;
    try {
      const ref = doc(db, "votos", usuarioActual.email);
      await setDoc(ref, {
        nombre: usuarioActual.nombre,
        email: usuarioActual.email,
        votos,
        fecha: new Date()
      });
      console.log("Votos guardados correctamente");
      mostrarExito("¬°Votos guardados exitosamente!");
    } catch (err) {
      console.error(err);
      mostrarError("Error guardando votos. Intenta de nuevo.");
    }
  }

  // üé• REPRODUCTOR DE VIDEO CORREGIDO - FUNCIONA CON TIKTOK Y KICK
  window.abrirVideo = function(url) {
    const iframe = document.getElementById('mini-video');
    let embedUrl = url;
    
    // TikTok: Convertir cualquier URL de TikTok a embed correcto
    if (url.includes('tiktok.com')) {
      // Extraer ID del video desde cualquier formato de URL de TikTok
      let videoId = null;
      
      // Formato: tiktok.com/@user/video/123456789
      const match1 = url.match(/\/video\/(\d+)/);
      if (match1) videoId = match1[1];
      
      // Formato embed existente
      if (url.includes('/embed/v2/')) {
        embedUrl = url;
      } 
      // Si encontramos ID, crear embed correcto
      else if (videoId) {
        embedUrl = `https://www.tiktok.com/embed/v2/${videoId}`;
      }
      // Fallback: usar URL directa (TikTok a veces funciona)
      else {
        embedUrl = url;
      }
    }
    // Kick clips funcionan directamente
    else if (url.includes('kick.com')) {
      embedUrl = url;
    }
    
    console.log('Reproduciendo:', embedUrl);
    iframe.src = embedUrl;
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen';
    iframe.allowFullscreen = true;
    document.getElementById('video-modal').classList.add('activo');
  };

  window.cerrarVideo = function() {
    const iframe = document.getElementById('mini-video');
    iframe.src = "";
    iframe.allow = '';
    document.getElementById('video-modal').classList.remove('activo');
  };

  // Cerrar modal con ESC o clic fuera
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      window.cerrarVideo();
    }
  });

  // Cerrar clic fuera del video
  document.getElementById('video-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      window.cerrarVideo();
    }
  });
});
</script>
</body>
</html>
